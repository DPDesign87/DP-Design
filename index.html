<script>
  document.getElementById("image-upload").addEventListener("change", function () {
    const reader = new FileReader();
    reader.onloadend = async function () {
      const base64Image = reader.result;

      const prompt = "design a trendy t-shirt illustration based on the uploaded image";

      try {
        const response = await fetch("https://dp-ai-backend.vercel.app/api/generate", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            image: base64Image,
            stylePrompt: prompt
          })
        });

        const data = await response.json();

        const output = document.getElementById("output");
        output.innerHTML = ""; // Clear previous results

        if (data.results && data.results.length > 0) {
          data.results.forEach((url) => {
            const img = document.createElement("img");
            img.src = url;
            img.alt = "Generated Design";
            img.className = "preview";
            output.appendChild(img);
          });
        } else {
          output.innerHTML = "<p>No results generated. Try again.</p>";
        }
      } catch (error) {
        console.error("Error generating designs:", error);
        document.getElementById("output").innerHTML = "<p>Failed to generate designs.</p>";
      }
    };

    reader.readAsDataURL(this.files[0]);
  });
</script>
